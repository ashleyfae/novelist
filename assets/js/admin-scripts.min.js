!function(e){var t={idNumber:!1,repeatEls:'input:not([type="button"]),select,textarea',init:function(){e(document).ready((function(){t.sortPurchaseLinks()}));var a=e(".novelist-repeatable-group");a.on("click",".novelist-repeater-heading",this.toggleRepeaterSection).on("click",".novelist-add-repeater-section",this.addRepeaterSection).on("click",".novelist-repeater-remove",this.removeRepeaterSection).on("novelist_remove_repeater_section",this.resetRepeaterCounter),a.length&&a.filter(".novelist-repeater-sortable").each((function(){e(this).find("button.novelist-repeater-remove").before('<button class="button novelist-repeater-shift-rows move-up alignleft" title="'+NOVELIST.repeater_move_up+'"><span class="dashicons dashicons-arrow-up-alt2"></span></button> <button class="button novelist-repeater-shift-rows move-down alignleft" title="'+NOVELIST.repeater_move_down+'"><span class="dashicons dashicons-arrow-down-alt2"></span></button>')})).on("click",".novelist-repeater-shift-rows",this.shiftRepeaterRows).on("novelist_add_repeater_section",this.emptyValue)},sortPurchaseLinks:function(){var t=e("#novelist-purchase-links tbody");t.length&&t.sortable({handle:".novelist-drag-handle",items:".novelist-cloned",opacity:.6,cursor:"move",axis:"y",update:function(){}})},toggleRepeaterSection:function(t){e(t.target).hasClass("dashicons-trash")||e(this).parent().toggleClass("novelist-repeater-section-expanded")},resetRepeaterCounter:function(t){e(".novelist-repeatable-group").each((function(){var t=e(this);t.find(".novelist-repeater-section").each((function(a){var n=e(this);n.data("iterator",a),n.find(".novelist-repeater-heading h3").text(t.find(".novelist-add-repeater-section").data("group-title").replace("{#}",a+1))}))}))},shiftRepeaterRows:function(a){a.preventDefault();var n=e(this),r=n.parents(".novelist-repeater-section"),o=n.hasClass("move-up")?r.prev(".novelist-repeater-section"):r.next(".novelist-repeater-section");if(o.length){n.trigger("novelist_shift_rows_start",n);var i=[];r.find(t.repeatEls).each((function(){var t,a=e(this);t="checkbox"===a.attr("type")||"radio"===a.attr("type")?a.is(":checked"):"select"===a.prop("tagName")?a.is(":selected"):a.val(),i.push({val:t,$:a})})),o.find(t.repeatEls).each((function(t){var a=e(this);"checkbox"===a.attr("type")||"radio"===a.attr("type")?(i[t].$.prop("checked",a.is(":checked")),a.prop("checked",i[t].val)):"select"===a.prop("tagName")?(i[t].$.prop("selected",a.is(":selected")),a.prop("selected",i[t].val)):(i[t].$.val(a.val()),a.val(i[t].val))})),n.trigger("novelist_shift_rows_complete",n)}},addRepeaterSection:function(a){a.preventDefault();var n=e(this),r=e(n.data("selector")),o=r.find(".novelist-repeater-section").last(),i=parseInt(o.data("iterator"));t.idNumber=i+1;var s=o.clone();t.newRowHousekeeping(s.data("title",n.data("group-title"))).cleanRow(s,i,!0);var l=e('<div class="novelist-repeater-section novelist-repeater-section-expanded" data-iterator="'+t.idNumber+'">'+s.html()+"</div>");o.after(l),r.find(".novelist-repeater-section").length<=1?r.find(".novelist-repeater-remove").prop("disabled",!0):r.find(".novelist-repeater-remove").prop("disabled",!1),r.trigger("novelist_add_repeater_section",l)},removeRepeaterSection:function(a){a.preventDefault();var n=e(this),r=e(n.data("selector")),o=n.parents(".novelist-repeater-section"),i=r.find(".novelist-repeater-section").length;i>1&&(o.nextAll(".novelist-repeater-section").find(t.repeatEls).each(t.updateRepeaterNameAttr),o.remove(),i<=2?r.find(".novelist-repeater-remove").prop("disabled",!0):r.find(".novelist-repeater-remove").prop("disabled",!1),r.trigger("novelist_remove_repeater_section"))},updateRepeaterNameAttr:function(){var t=e(this),a=t.attr("name");if(void 0===a)return!1;var n=parseInt(t.parents(".novelist-repeater-section").data("iterator")),r=n-1,o=a.replace("["+n+"]","["+r+"]");t.attr("name",o)},newRowHousekeeping:function(a){var n=a.find(".wp-picker-container");return n.length&&n.each((function(){var t=e(this).parent();t.html(t.find('input[type="text"].novelist-colorpicker').attr("style",""))})),t},cleanRow:function(a,n){var r=a.find('input:not([type="button"]), select, textarea, label'),o=a.find("[id]").not('input:not([type="button"]), select, textarea, label');o.length&&o.each((function(){var r=e(this),o=r.attr("id"),i=o.replace("_"+n,"_"+t.idNumber),s=a.find('[data-selector="'+o+'"]');r.attr("id",i),s.length&&s.attr("data-selector",i).data("selector",i)})),r.filter(":checked").prop("checked",!1),r.filter(":selected").prop("selected",!1),a.find(".novelist-repeater-heading h3").length&&a.find(".novelist-repeater-heading h3").text(a.data("title").replace("{#}",t.idNumber+1)),r.each((function(){var a,r=e(this),o=r.attr("for"),i={};if(o)i={for:o.replace("_"+n,"_"+t.idNumber)};else{var s=r.attr("name"),l=s?s.replace("["+n+"]","["+t.idNumber+"]"):"";i={id:(a=r.attr("id"))?a.replace("_"+n,"_"+t.idNumber):"",name:l,"data-iterator":t.idNumber}}r.attr(i).val("")}))},emptyValue:function(t,a){e('input:not([type="button"]), textarea',a).val("")}};t.init(),e(".novelist-sortable").sortable({cancel:".novelist-no-sort, textarea, input, select",connectWith:".novelist-sortable",placeholder:"novelist-sortable-placeholder",update:function(t,a){var n=a.item,r=n.parent().attr("id"),o=n.find(".novelist-book-option-disabled");e("#"+r).hasClass("novelist-sorter-enabled-column")?o.val("false"):o.val("true")}}).enableSelection(),e(".novelist-book-option-toggle").click((function(t){e(this).next().slideToggle()})),e("#novelist-book-layout-cover-changer").change((function(){var t=e("#novelist-book-option-cover");t.removeClass((function(e,t){return(t.match(/(^|\s)novelist-book-cover-align-\S+/g)||[]).join(" ")})),t.addClass("novelist-book-cover-align-"+e(this).val())})),e("#novelist-add-link").relCopy(),e(".novelist-color-picker").wpColorPicker(),e("#novelist-reset-tab-button").click((function(t){if(t.preventDefault(),!confirm(NOVELIST.confirm_reset))return!1;var a=e(this).parent();a.append('<span id="novelist-spinner" class="spinner is-active"></span>');var n={action:"novelist_restore_default_settings",tab:e(this).data("current-tab"),section:e(this).data("current-section"),_ajax_nonce:e(this).data("nonce")};e.post(ajaxurl,n,(function(t){e("#novelist-spinner").remove(),1==t.success?window.location.href=t.data:a.append(t.data)}))})),e("#novelist-import-demo-book").click((function(t){t.preventDefault();var a=e(this).parent();e(this).attr("disabled","true"),a.append('<span id="novelist-spinner" class="spinner is-active" style="float: none;"></span>');var n={action:"novelist_import_demo_book",nonce:e(this).data("nonce")};e.post(ajaxurl,n,(function(e){a.empty().append(e.data)}))}))}(jQuery);
